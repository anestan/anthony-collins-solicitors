var tribe_event_tickets_plus=tribe_event_tickets_plus||{};tribe_event_tickets_plus.meta=tribe_event_tickets_plus.meta||{},tribe_event_tickets_plus.meta.admin=tribe_event_tickets_plus.meta.admin||{},tribe_event_tickets_plus.meta.admin.event=tribe_event_tickets_plus.meta.admin.event||{},function(e,t,i,s){"use strict";s.selectors={fieldsetSaved:".tribe-tickets__admin-attendees-saved-fields",fieldsetSavedHasIac:".tribe-tickets__admin-attendees-saved-fields--has-iac",iacNotice:".tribe-tickets__admin-attendees-info-iac-notice",iacMockedFields:".tribe-tickets__admin-attendees-info-iac-fields",iacMockedFieldsLabelRequired:".tribe-tickets__admin-attendee-info-field-title-label--required",iacNoneCheckbox:"#ticket_iac_setting_none",iacAllowedCheckbox:"#ticket_iac_setting_allowed",iacRequiredCheckbox:"#ticket_iac_setting_required",hidden:".tribe-common-a11y-hidden"},s.init=function(){s.$tribe_tickets=i(t.getElementById("tribetickets")),s.$event_tickets=i(t.getElementById("event_tickets")),s.$event_tickets.on("change","input.show_attendee_info",s.event.toggleLinkedForm).on("change",".save_attendee_fieldset",s.event.toggleLinkedForm),i(".meta-postbox .hndle, .meta-postbox .handlediv").off("click"),s.$tribe_tickets.on("change",".ticket-attendee-info-dropdown",s.event.selectSavedFieldset).on("change",".save_attendee_fieldset",s.event.toggleLinkedForm).on("click",".meta-postbox .hndle, .meta-postbox .handlediv",s.event.clickPostbox).on("click","a.add-attendee-field",s.event.addField).on("click","a.delete-attendee-field",s.event.removeField).on("edit-ticket.tribe",s.event.editTicket).on("saved-ticket.tribe",s.event.savedTicket).on("click","#rsvp_form_toggle",s.event.handleNewRsvp).on("click","#ticket_form_toggle",s.event.handleNewTicket).on("change",s.selectors.iacNoneCheckbox,s.event.handleIacCheckbox).on("change",s.selectors.iacAllowedCheckbox,s.event.handleIacCheckbox).on("change",s.selectors.iacRequiredCheckbox,s.event.handleIacCheckbox),s.initTicketFields(),s.$event_tickets.trigger("event-tickets-plus-meta-initialized.tribe")},s.initTicketFields=function(){s.$event_tickets||(s.$event_tickets=i(t.getElementById("event_tickets"))),s.initCustomFieldSorting(),s.maybeHideSavedFieldsSelect(),s.maybeShowIacMockedFields(),s.$event_tickets.trigger("event-tickets-plus-ticket-meta-initialized.tribe",{ticket_id:s.$event_tickets.find("#ticket_id").val()})},s.initCustomFieldSorting=function(){i(t.getElementById("tribe-tickets-attendee-sortables")).sortable({containment:"parent",items:"> div",tolerance:"pointer",connectWith:"#tribe-tickets-attendee-sortables"})},s.toggleLinkedForm=function(e){let s=i();const n=e.data("tribe-toggle");n&&(s=i(t.getElementById(n))),e.is(":checked")?s.show():s.hide()},s.maybeHideSavedFieldsSelect=function(){i(".tribe-tickets__admin-attendee-info-field--active").length?i(s.selectors.fieldsetSaved).hide():i(s.selectors.fieldsetSaved).show()},s.maybeShowIacMockedFields=function(){const e=i(s.selectors.iacAllowedCheckbox).is(":checked"),t=i(s.selectors.iacRequiredCheckbox).is(":checked");e||t?s.showIacMockedFields():s.hideIacMockedFields()},s.hideIacMockedFields=function(){const e=i(s.selectors.iacAllowedCheckbox).closest("#ticket_form"),t=e.find(s.selectors.iacNotice),n=e.find(s.selectors.iacMockedFields),d=e.find(s.selectors.fieldsetSaved),c=s.selectors.hidden.className();t.addClass(c),n.addClass(c),d.removeClass(s.selectors.fieldsetSavedHasIac.className())},s.showIacMockedFields=function(){const e=i(s.selectors.iacAllowedCheckbox).closest("#ticket_form"),t=e.find(s.selectors.iacMockedFields),n=e.find(s.selectors.iacNotice),d=t.find(s.selectors.iacMockedFieldsLabelRequired),c=e.find(s.selectors.fieldsetSaved),o=i(s.selectors.iacRequiredCheckbox).is(":checked"),a=s.selectors.hidden.className();n.removeClass(a),t.removeClass(a),o?d.removeClass(a):d.addClass(a),c.addClass(s.selectors.fieldsetSavedHasIac.className())},s.event.handleIacCheckbox=function(e){e.preventDefault(),s.maybeShowIacMockedFields()},s.event.handleNewTicket=function(e){e.preventDefault(),s.maybeShowIacMockedFields()},s.event.handleNewRsvp=function(e){e.preventDefault(),s.hideIacMockedFields()},s.fetch_saved_fields=function(e){const t={action:"tribe-tickets-load-saved-fields",fieldset:e};return i.post(ajaxurl,t,"json")},s.inject_saved_fields=function(e){const n=s.fetch_saved_fields(e);n.done(function(n){n.success?(i(t.getElementById("tribe-tickets-attendee-sortables")).append(n.data),s.maybeHideSavedFieldsSelect(),s.$event_tickets.trigger("event-tickets-plus-fieldset-loaded.tribe",{fieldset_id:e})):s.$event_tickets.trigger("event-tickets-plus-fieldset-load-failure.tribe",{fieldset_id:e})}),n.fail(function(){s.$event_tickets.trigger("event-tickets-plus-fieldset-load-failure.tribe",{fieldset_id:e})})},s.addField=function(e){const n={action:"tribe-tickets-info-render-field",type:e},d=i.post(ajaxurl,n,"json");d.done(function(n){n.success?(i(t.getElementById("tribe-tickets-attendee-sortables")).append(n.data),s.maybeHideSavedFieldsSelect(),s.$event_tickets.trigger("event-tickets-plus-field-added.tribe",{type:e})):s.$event_tickets.trigger("event-tickets-plus-field-add-failure.tribe",{type:e})}),d.fail(function(){s.$event_tickets.trigger("event-tickets-plus-field-add-failure.tribe",{type:e})})},s.removeField=function(e){let t="";t="undefined"!==e[0].outerHTML?e[0].outerHTML:i("<div>").append(e.eq(0).clone()).html(),e.remove(),s.maybeHideSavedFieldsSelect(),s.$event_tickets.trigger("event-tickets-plus-field-removed.tribe",{field:t})},s.toggle_postbox=function(e){e.toggleClass("closed")},s.event.toggleLinkedForm=function(){s.toggleLinkedForm(i(this))},s.event.selectSavedFieldset=function(){const e=i(this).val();e&&0!==parseInt(e,10)&&s.inject_saved_fields(e)},s.event.addField=function(e){e.preventDefault(),s.addField(i(this).data("type"))},s.event.removeField=function(e){e.preventDefault(),s.removeField(i(this).closest(".meta-postbox"))},s.event.editTicket=function(){s.initTicketFields()},s.event.clickPostbox=function(){s.toggle_postbox(i(this).closest(".meta-postbox"))},s.event.savedTicket=function(e,s){if(void 0===s.fieldsets||!s.success)return;const n=i(t.getElementById("saved_ticket-attendee-info"));n.find('option:not([value="0"])').remove();for(let e=0;e<s.fieldsets.length;e++)n.append('<option value="'+s.fieldsets[e].ID+'" data-attendee-group="'+s.fieldsets[e].post_name.replace('"','\\"')+'">'+s.fieldsets[e].post_name+"</option>")},i(s.init)}(window,document,jQuery,tribe_event_tickets_plus.meta.admin);